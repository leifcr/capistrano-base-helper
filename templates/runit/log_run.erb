#!/bin/sh
#
# Log output for <%= fetch(:application) %> as <%= fetch(:user) %> in env <%= environment %>
#
# make sure the log directory exists
mkdir -p "<%= File.join("/var", "log", "service", Capistrano::BaseHelper.user_app_env_path, "runit") %>"
# make sure the right owner is on the log directory
chown -R <%= "#{fetch(:runit_log_user)}:#{fetch(:runit_log_group)}" %> "<%= File.join("/var", "log", "service", Capistrano::BaseHelper.user_app_env_path, "runit") %>"
# change path to the log directory
cd "<%= File.join("/var", "log", "service", Capistrano::BaseHelper.user_app_env_path, "runit") %>"
# start logging
exec chpst -u <%= fetch(:runit_log_user)%> svlogd -tt "<%= File.join("/var", "log", "service", Capistrano::BaseHelper.user_app_env_path, "runit") %>"
